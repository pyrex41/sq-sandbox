# deploy/hetzner/docker-compose.yml
# CX32 (4c/8GB) €8/mo + Volume (100GB) €4/mo = €12/mo
services:
  squash:
    build: ../..
    privileged: true
    restart: unless-stopped
    ports: ["8080:8080"]
    volumes: [squash-data:/data]
    environment:
      SQUASH_AUTH_TOKEN: ${SQUASH_AUTH_TOKEN}
      SQUASH_S3_BUCKET: ${SQUASH_S3_BUCKET:-}
      SQUASH_S3_ENDPOINT: ${SQUASH_S3_ENDPOINT:-}
      SQUASH_S3_REGION: ${SQUASH_S3_REGION:-us-east-1}
      SQUASH_S3_PREFIX: ${SQUASH_S3_PREFIX:-}
      AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID:-}
      AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY:-}
      TAILSCALE_AUTHKEY: ${TAILSCALE_AUTHKEY:-}
      TAILSCALE_HOSTNAME: ${TAILSCALE_HOSTNAME:-squash}
    healthcheck:
      test: wget -qO- http://localhost:8080/cgi-bin/health
      interval: 30s
      start_period: 60s

volumes:
  squash-data:
