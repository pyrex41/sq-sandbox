#!/bin/sh
# squash/bin/setup-tailscale
set -eu
[ -z "${TAILSCALE_AUTHKEY:-}" ] && { echo "[tailscale] no TAILSCALE_AUTHKEY, skipping"; exit 0; }
mkdir -p /data/tailscale
tailscaled --state=/data/tailscale/state --tun=userspace-networking &
sleep 2
tailscale up --authkey="$TAILSCALE_AUTHKEY" --hostname="${TAILSCALE_HOSTNAME:-squash}" --accept-routes
echo "[tailscale] connected: $(tailscale ip -4)"
